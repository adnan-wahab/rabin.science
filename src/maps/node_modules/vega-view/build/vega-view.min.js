!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("vega-dataflow"),require("vega-scenegraph"),require("vega-util"),require("d3-array"),require("vega-parser"),require("vega-runtime")):"function"==typeof define&&define.amd?define(["exports","vega-dataflow","vega-scenegraph","vega-util","d3-array","vega-parser","vega-runtime"],n):n(e.vega=e.vega||{},e.vega,e.vega,e.vega,e.d3,e.vega,e.vega)}(this,function(e,n,t,r,i,a,o){"use strict";function s(e){n.Transform.call(this,null,e)}function u(e,n,t){return n(e.bounds.clear(),e,t)}function d(e){n.Transform.call(this,null,e)}function l(e){var n=e.groups,t=e.parent;return n&&1===n.size?n.get(Object.keys(n.object)[0]):n&&t?n.lookup(t):null}function c(e){n.Transform.call(this,null,e)}function h(e){for(var n,t,r=e.items,i=r.length,a=0,o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};a<i;++a)if(n=r[a],t=n.items,"group"===n.marktype)switch(n.role){case he:case fe:break;case ge:f(t,o.rowheaders);break;case me:f(t,o.rowfooters);break;case pe:f(t,o.colheaders);break;case ye:f(t,o.colfooters);break;case ve:o.rowtitle=t[0];break;case be:o.coltitle=t[0];break;default:f(t,o.marks)}return o}function f(e,n){for(var t=0,r=e.length;t<r;++t)n.push(e[t])}function g(e){return{x1:0,y1:0,x2:e.width||0,y2:e.height||0}}function m(e){return e.bounds.clone().translate(-(e.x||0),-(e.y||0))}function v(e,n){var t={x1:e.x,y1:e.y,x2:e.x+e.width,y2:e.y+e.height};return t[n]}function p(e,n){return e.bounds[n]}function y(e,n,t){return(r.isObject(e)?e[n]:e)||t||0}function b(e,n,r){function i(e,n){return Math.floor(Math.min(e,n))}function a(e,n){return Math.ceil(Math.max(e,n))}var o,s,u,d,l,c,f,b,x,k,M,z=h(n,r),T=z.marks,L="flush"===r.bounds,E=L?g:m,C=new t.Bounds(0,0,0,0),S=y(r.align,"column"),D=y(r.align,"row"),A=y(r.padding,"column"),R=y(r.padding,"row"),O=r.offset,U=r.columns||T.length,q=U<0?1:Math.ceil(T.length/U),H=q*U,j=[],B=0,P=[],G=0,V=T.length;for(s=0;s<V;++s)d=E(T[s]),c=s%U===0?0:Math.ceil(E(T[s-1]).x2),f=s<U?0:Math.ceil(E(T[s-U]).y2),b=(d.x1<0?Math.ceil(-d.x1):0)+c,x=(d.y1<0?Math.ceil(-d.y1):0)+f,j.push(b+A),P.push(x+R),e.dirty(T[s]);for(s=0;s<V;++s)s%U===0&&(j[s]=B),s<U&&(P[s]=G);if("each"===S)for(u=1;u<U;++u){for(M=0,s=u;s<V;s+=U)M<j[s]&&(M=j[s]);for(s=u;s<V;s+=U)j[s]=M}else if("all"===S){for(M=0,s=0;s<V;++s)s%U&&M<j[s]&&(M=j[s]);for(s=0;s<V;++s)s%U&&(j[s]=M)}if("each"===D)for(u=1;u<q;++u){for(M=0,s=u*U,o=s+U;s<o;++s)M<P[s]&&(M=P[s]);for(s=u*U;s<o;++s)P[s]=M}else if("all"===D){for(M=0,s=U;s<V;++s)M<P[s]&&(M=P[s]);for(s=U;s<V;++s)P[s]=M}for(b=0,s=0;s<V;++s)l=T[s],c=l.x||0,l.x=b=j[s]+(s%U?b:0),l.bounds.translate(b-c,0);for(u=0;u<U;++u)for(x=0,s=u;s<V;s+=U)l=T[s],f=l.y||0,l.y=x+=P[s],l.bounds.translate(0,x-f);for(s=0;s<V;++s)T[s].mark.bounds.clear();for(s=0;s<V;++s)l=T[s],e.dirty(l),C.union(l.mark.bounds.union(l.bounds));E=L?v:p,b=_(e,z.rowheaders,T,U,q,-y(O,"rowHeader"),i,0,E,"x1",0,U,1),x=_(e,z.colheaders,T,U,U,-y(O,"columnHeader"),i,1,E,"y1",0,1,U),_(e,z.rowfooters,T,U,q,y(O,"rowFooter"),a,0,E,"x2",U-1,U,1),_(e,z.colfooters,T,U,U,y(O,"columnFooter"),a,1,E,"y2",H-U,1,U),z.rowtitle&&(M=b-y(O,"rowTitle"),k=y(r.titleBand,"row",.5),w(e,z.rowtitle,M,0,C,k)),z.coltitle&&(M=x-y(O,"columnTitle"),k=y(r.titleBand,"column",.5),w(e,z.coltitle,M,1,C,k))}function _(e,n,t,r,i,a,o,s,u,d,l,c,h){var f,g,m,v,p,y,b,_,w,x=t.length,k=0,M=0;for(f=l;f<x;f+=c)t[f]&&(k=o(k,u(t[f],d)));if(!n.length)return k;for(n.length>i&&(e.warn("Grid headers exceed limit: "+i),n=n.slice(0,i)),k+=a,g=0,v=n.length;g<v;++g)e.dirty(n[g]),n[g].mark.bounds.clear();for(f=l,g=0,v=n.length;g<v;++g,f+=c){for(y=n[g],p=y.mark.bounds,m=f;null==(b=t[m]);m-=h);s?(_=b.x,w=k):(_=k,w=b.y),p.union(y.bounds.translate(_-(y.x||0),w-(y.y||0))),y.x=_,y.y=w,e.dirty(y),M=o(M,p[d])}return M}function w(e,n,t,r,i,a){if(n){e.dirty(n);var o=t,s=t;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),n.bounds.translate(o-(n.x||0),s-(n.y||0)),n.mark.bounds.clear().union(n.bounds),n.x=o,n.y=s,e.dirty(n)}}function x(e){n.Transform.call(this,null,e)}function k(e,n,r){var i,a,o,s,u,d,l=n.items,c=Math.max(0,n.width||0),h=Math.max(0,n.height||0),f=(new t.Bounds).set(0,0,c,h),g=f.clone(),m=f.clone(),v=[];for(u=0,d=l.length;u<d;++u)switch(a=l[u],a.role){case ke:g.union(s=L(e,a,c,h)),z(a)&&m.union(s);break;case Me:i=a;break;case Te:v.push(a);break;case ze:case Le:case Ee:case Ce:case Se:case De:m.union(a.bounds);break;default:f.union(a.bounds)}if(i&&(g.union(s=E(e,i,g)),z(i)&&m.union(s)),v.length)for(o={left:0,right:0,margin:r.legendMargin||8},u=0,d=v.length;u<d;++u)s=C(e,v[u],o,m,c,h),r.autosize&&r.autosize.type===_e?f.add(s.x1,0).add(s.x2,0):f.union(s);S(e,n,f.union(m).union(g),r)}function M(e,n,t){return e[n]===t?0:(e[n]=t,1)}function z(e){var n=e.items[0].datum.orient;return"left"===n||"right"===n}function T(e){var n=+e.grid;return[e.ticks?n++:-1,e.labels?n++:-1,n+ +e.domain]}function L(e,n,r,i){var a,o,s=n.items[0],u=s.datum,d=u.orient,l=T(u),c=s.range,h=s.offset,f=s.position,g=s.minExtent,m=s.maxExtent,v=u.title&&s.items[l[2]].items[0],p=s.titlePadding,y=s.bounds,b=0,_=0;switch(Ae.clear().union(y),y.clear(),(a=l[0])>-1&&y.union(s.items[a].bounds),(a=l[1])>-1&&y.union(s.items[a].bounds),d){case"top":b=f||0,_=-h,o=Math.max(g,Math.min(m,-y.y1)),v&&(v.auto?(v.y=-(o+=p),o+=v.bounds.height()):y.union(v.bounds)),y.add(0,-o).add(c,0);break;case"left":b=-h,_=f||0,o=Math.max(g,Math.min(m,-y.x1)),v&&(v.auto?(v.x=-(o+=p),o+=v.bounds.width()):y.union(v.bounds)),y.add(-o,0).add(0,c);break;case"right":b=r+h,_=f||0,o=Math.max(g,Math.min(m,y.x2)),v&&(v.auto?(v.x=o+=p,o+=v.bounds.width()):y.union(v.bounds)),y.add(0,0).add(o,c);break;case"bottom":b=f||0,_=i+h,o=Math.max(g,Math.min(m,y.y2)),v&&(v.auto?(v.y=o+=p,o+=v.bounds.height()):y.union(v.bounds)),y.add(0,0).add(c,o);break;default:b=s.x,_=s.y}return t.boundStroke(y.translate(b,_),s),M(s,"x",b+.5)|M(s,"y",_+.5)&&(s.bounds=Ae,e.dirty(s),s.bounds=y,e.dirty(s)),s.mark.bounds.clear().union(y)}function E(e,n,t){var r=n.items[0],i=r.datum,a=i.orient,o=r.offset,s=r.bounds,u=0,d=0;switch(Ae.clear().union(s),a){case"top":u=r.x,d=t.y1-o;break;case"left":u=t.x1-o,d=r.y;break;case"right":u=t.x2+o,d=r.y;break;case"bottom":u=r.x,d=t.y2+o;break;default:u=r.x,d=r.y}return s.translate(u-r.x,d-r.y),M(r,"x",u)|M(r,"y",d)&&(r.bounds=Ae,e.dirty(r),r.bounds=s,e.dirty(r)),n.bounds.clear().union(s)}function C(e,n,r,i,a,o){var s,u,d=n.items[0],l=d.datum,c=l.orient,h=d.offset,f=d.bounds,g=0,m=r[c]||0;switch(Ae.clear().union(f),f.clear(),d.items.forEach(function(e){f.union(e.bounds)}),s=Math.round(f.width())+2*d.padding-1,u=Math.round(f.height())+2*d.padding-1,c){case"left":g-=s+h-Math.floor(i.x1),r.left+=u+r.margin;break;case"right":g+=h+Math.ceil(i.x2),r.right+=u+r.margin;break;case"top-left":g+=h,m+=h;break;case"top-right":g+=a-s-h,m+=h;break;case"bottom-left":g+=h,m+=o-u-h;break;case"bottom-right":g+=a-s-h,m+=o-u-h;break;default:g=d.x,m=d.y}return t.boundStroke(f.set(g,m,g+s,m+u),d),M(d,"x",g)|M(d,"width",s)|M(d,"y",m)|M(d,"height",u)&&(d.bounds=Ae,e.dirty(d),d.bounds=f,e.dirty(d)),d.mark.bounds.clear().union(f)}function S(e,n,t,r){var i=r.autosize&&r.autosize.type,a=r.autosize&&r.autosize.resize,o=e._width,s=e._height;if(!(e._autosize<1)&&i){var u=Math.max(0,n.width||0),d=Math.max(0,Math.ceil(-t.x1)),l=Math.max(0,Math.ceil(t.x2-u)),c=Math.max(0,n.height||0),h=Math.max(0,Math.ceil(-t.y1)),f=Math.max(0,Math.ceil(t.y2-c));i===xe?(o=u,s=c,d=0,h=0):i===_e?(u=Math.max(0,o-d-l),c=Math.max(0,s-h-f)):i===we&&(o=u+d+l,s=c+h+f),e.autosize(o,s,u,c,[d,h],a)}}function D(e){"undefined"!=typeof document&&document.body&&(document.body.style.cursor=e)}function A(e,n){var t=e._runtime.data;return t.hasOwnProperty(n)||e.error("Unrecognized data set: "+n),t[n]}function R(e){return A(this,e).values.value}function O(e,t){n.isChangeSet(t)||this.error("Second argument to changes must be a changeset.");var r=A(this,e);return r.modified=!0,this.pulse(r.input,t)}function U(e,t){return O.call(this,e,n.changeset().insert(t))}function q(e,t){return O.call(this,e,n.changeset().remove(t))}function H(e){var n=e.padding();return Math.max(0,e._width+n.left+n.right)}function j(e){var n=e.padding();return Math.max(0,e._height+n.top+n.bottom)}function B(e){var n=e.padding(),t=e._origin;return[n.left+t[0],n.top+t[1]]}function P(e){var n=B(e);e._renderer.background(e._background),e._renderer.resize(H(e),j(e),n),e._handler.origin(n)}function G(e,n,t){function i(e){var t,r=o;if(e)for(t=n;t;t=t.mark.group)if(t.mark.name===e){r=t;break}return r&&r.mark&&r.mark.interactive?r:{}}function a(e){if(!e)return t;r.isString(e)&&(e=i(e));for(var n=t.slice();e;)n[0]-=e.x||0,n[1]-=e.y||0,e=e.mark&&e.mark.group;return n}var o=n?"group"===n.mark.marktype?n:n.mark.group:null;return{view:r.constant(e),item:r.constant(n||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}function V(e){return e.item}function I(e){var n=e.item.mark.source;return n.source||n}function W(e){return function(n,t){return t.vega.view().changeset().encode(t.item,e)}}function F(e,n,t,r){var i=Ve("div",{class:Ie});i.appendChild(Ve("span",{class:We},t.name||t.signal)),n.appendChild(i);var a=N;switch(t.input){case"checkbox":a=J;break;case"select":a=K;break;case"radio":a=Q;break;case"range":a=X}a(e,i,t,r)}function N(e,n,t,r){var i=Ve("input");for(var a in t)"signal"!==a&&"element"!==a&&i.setAttribute("input"===a?"type":a,t[a]);i.setAttribute("name",t.signal),i.value=r,n.appendChild(i),i.addEventListener("input",function(){e.update(i.value)}),e.elements=[i],e.set=function(e){i.value=e}}function J(e,n,t,r){var i={type:"checkbox",name:t.signal};r&&(i.checked=!0);var a=Ve("input",i);n.appendChild(a),a.addEventListener("change",function(){e.update(a.checked)}),e.elements=[a],e.set=function(e){a.checked=!!e||null}}function K(e,n,t,r){var i=Ve("select",{name:t.signal});t.options.forEach(function(e){var n={value:e};Y(e,r)&&(n.selected=!0),i.appendChild(Ve("option",n,e+""))}),n.appendChild(i),i.addEventListener("change",function(){e.update(t.options[i.selectedIndex])}),e.elements=[i],e.set=function(e){for(var n=0,r=t.options.length;n<r;++n)if(Y(t.options[n],e))return void(i.selectedIndex=n)}}function Q(e,n,t,r){var i=Ve("span",{class:Fe});n.appendChild(i),e.elements=t.options.map(function(n){var a=Ne+t.signal+"-"+n,o={id:a,type:"radio",name:t.signal,value:n};Y(n,r)&&(o.checked=!0);var s=Ve("input",o);return s.addEventListener("change",function(){e.update(n)}),i.appendChild(s),i.appendChild(Ve("label",{for:a},n+"")),s}),e.set=function(n){for(var t=e.elements,r=0,i=t.length;r<i;++r)Y(t[r].value,n)&&(t[r].checked=!0)}}function X(e,n,t,r){function a(){l.textContent=d.value,e.update(+d.value)}r=void 0!==r?r:(+t.max+ +t.min)/2;var o=t.min||Math.min(0,+r)||0,s=t.max||Math.max(100,+r)||100,u=t.step||i.tickStep(o,s,100),d=Ve("input",{type:"range",name:t.signal,min:o,max:s,step:u});d.value=r;var l=Ve("label",{},+r);n.appendChild(d),n.appendChild(l),d.addEventListener("input",a),d.addEventListener("change",a),e.elements=[d],e.set=function(e){d.value=e,l.textContent=e}}function Y(e,n){return e===n||e+""==n+""}function Z(e,n){return"string"==typeof n&&(n="undefined"!=typeof document?document.querySelector(n):e.error("DOM document instance not found.")),n.innerHTML="",n}function $(e,n){var t=new Blob([e],{type:n});return window.URL.createObjectURL(t)}function ee(e,n){var t=e.add(null,function(t){e["_"+n]=t.size,e._autosize=e._resize=1},{size:e._signals[n]});return t.rank=0,t}function ne(e,n,t,r,i,a){this.runAfter(function(o){var s=0;o._autosize=0,o.width()!==t&&(s=1,o.width(t),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.height(r),o._resizeHeight.skip(!0)),o._width!==e&&(o._resize=1,o._width=e),o._height!==n&&(o._resize=1,o._height=n),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter(function(){o.resize()})})}function te(e){return this._runtime.getState(e||{data:re,signals:ie,recurse:!0})}function re(e,n){return n.modified&&r.isArray(n.input.value)&&e.indexOf("_:vega:_")}function ie(e,t){return!("parent"===e||t instanceof n.transforms.Proxy)}function ae(e){var n=this;return n._trigger=!1,n._runtime.setState(e),n.run().runAfter(function(){n._trigger=!0}),this}function oe(e,i){i=i||{},n.Dataflow.call(this),this.loader(i.loader||this._loader),this.logLevel(i.logLevel||0),this._el=null,this._renderType=i.renderer||t.RenderType.Canvas,this._scenegraph=new t.Scenegraph;var a=this._scenegraph.root;this._renderer=null,this._redraw=!0,this._handler=(new t.CanvasHandler).scene(a),this._eventListeners=[],this._preventDefault=!0;var o=nn(this,e,i.functions);this._runtime=o,this._signals=o.signals,this._bind=(e.bindings||[]).map(function(e){return{state:null,param:r.extend({},e)}}),o.root&&o.root.set(a),a.source=o.data.root.input,this.pulse(o.data.root.input,this.changeset().insert(a.items)),this._background=o.background||null,this._width=this.width(),this._height=this.height(),this._origin=[0,0],this._resize=0,this._autosize=1,this._resizeWidth=ee(this,"width"),this._resizeHeight=ee(this,"height"),Ue(this)}function se(e,n){return e._signals.hasOwnProperty(n)?e._signals[n]:e.error("Unrecognized signal name: "+r.stringValue(n))}var ue=r.inherits(s,n.Transform),de=new t.Bounds;ue.transform=function(e,n){var r,i=n.dataflow,a=e.mark,o=a.marktype,s=t.Marks[o],d=s.bound,l=a.clip,c=a.bounds;return s.nested?(a.items.length&&i.dirty(a.items[0]),c=u(a,d),a.items.forEach(function(e){e.bounds.clear().union(c)})):"group"===o||e.modified()?(n.visit(n.MOD,function(e){i.dirty(e)}),c.clear(),a.items.forEach(function(e){c.union(u(e,d))})):(r=n.changed(n.REM),n.visit(n.ADD,function(e){c.union(u(e,d))}),n.visit(n.MOD,function(e){r=r||c.alignsWith(e.bounds),i.dirty(e),c.union(u(e,d))}),r&&!l&&(c.clear(),a.items.forEach(function(e){c.union(e.bounds)}))),l&&c.intersect(de.set(0,0,a.group.width,a.group.height)),n.modifies("bounds")};var le=r.inherits(d,n.Transform);le.transform=function(e,n){var r=this.value;r||(r=n.dataflow.scenegraph().mark(e.markdef,l(e),e.index),r.group.context=e.context,e.context.group||(e.context.group=r.group),r.source=this,this.value=r);var i="group"===r.marktype?t.GroupItem:t.Item;return n.visit(n.ADD,function(e){i.call(e,r)}),r.items=n.source,n};var ce=r.inherits(c,n.Transform);ce.transform=function(e,n){var t=n.dataflow;if(n.visit(n.ALL,function(e){t.dirty(e)}),n.fields&&n.fields.zindex){var r=n.source&&n.source[0];r&&(r.mark.zdirty=!0)}};var he="axis",fe="legend",ge="row-header",me="row-footer",ve="row-title",pe="column-header",ye="column-footer",be="column-title",_e="fit",we="pad",xe="none",ke="axis",Me="title",ze="frame",Te="legend",Le="scope",Ee="row-header",Ce="row-footer",Se="column-header",De="column-footer",Ae=new t.Bounds,Re=r.inherits(x,n.Transform);Re.transform=function(e,n){var t=n.dataflow;return e.mark.items.forEach(function(n){e.layout&&b(t,n,e.layout),k(t,n,e)}),n};var Oe="default",Ue=function(e){var n=e._signals.cursor;n||(e._signals.cursor=n=e.add({user:Oe,item:null})),e.on(e.events("view","mousemove"),n,function(e,t){var i=n.value,a=i?r.isString(i)?i:i.user:Oe,o=t.item&&t.item.cursor||null;return i&&a===i.user&&o==i.item?i:{user:a,item:o}}),e.add(null,function(e){var n=e.cursor,t=this.value;return r.isString(n)||(t=n.item,n=n.user),D(n&&n!==Oe?n:t||n),t},{cursor:n})},qe=function(e,n,r){var i,a,o,s=e._renderer.element();return s&&(o=B(e),a=n.changedTouches?n.changedTouches[0]:n,i=t.point(a,s),i[0]-=o[0],i[1]-=o[1]),n.vega=G(e,r,i),n.item=r,n},He="view",je="window",Be=function(e,t,r){var i,a=this,o=new n.EventStream(r),s=function(n,t){a.preventDefault()&&e===He&&n.preventDefault(),o.receive(qe(a,n,t)),a.run()};if(e===He)return a.addEventListener(t,s),o;if(e===je?"undefined"!=typeof window&&(i=[window]):"undefined"!=typeof document&&(i=document.querySelectorAll(e)),!i)return a.warn("Can not resolve event source: "+e),o;for(var u=0,d=i.length;u<d;++u)i[u].addEventListener(t,s);return a._eventListeners.push({type:t,sources:i,handler:s}),o},Pe=function(e,n){return this.on(this.events("view","mouseover",V),I,W(e||"hover")),this.on(this.events("view","mouseout",V),I,W(n||"update")),this},Ge=function(){for(var e,n,t=this._eventListeners,r=t.length;--r>=0;)for(n=t[r],e=n.sources.length;--e>=0;)n.sources[e].removeEventListener(n.type,n.handler)},Ve=function(e,n,t){var r=document.createElement(e);for(var i in n)r.setAttribute(i,n[i]);return null!=t&&(r.textContent=t),r},Ie="vega-bind",We="vega-bind-name",Fe="vega-bind-radio",Ne="vega-option-",Je=function(e,n,t){var i=t.param,a=t.state||(t.state={elements:null,set:null,update:function(n){a.source=!0,e.signal(i.signal,n).run()},active:!1});return r.isString(n)&&(n=document.querySelector(n)),F(a,n,i,e.signal(i.signal)),a.active||(e.on(e._signals[i.signal],null,function(){a.source?a.source=!1:a.set(e.signal(i.signal))}),a.active=!0),a},Ke=function(e,n,t,r){return n=n||new r(e.loader()),n.initialize(t,H(e),j(e),B(e)).background(e._background)},Qe=function(e,n,t,r){var i=(new r).scene(e.scenegraph().root).initialize(t,B(e),e);return n&&(i.handleTooltip=n.handleTooltip,n.handlers().forEach(function(e){i.on(e.type,e.handler)})),i},Xe=function(e,n){var r,i,a=this,o=a._renderType,s=t.renderModule(o);return e=a._el=e?Z(a,e):null,s||a.error("Unrecognized renderer type: "+o),r=s.handler||t.CanvasHandler,i=e?s.renderer:s.headless,a._renderer=i?Ke(a,a._renderer,e,i):null,a._handler=Qe(a,a._handler,e,r),a._redraw=!0,e&&(n=n?Z(a,n):e.appendChild(Ve("div",{class:"vega-bindings"})),a._bind.forEach(function(e){e.param.element&&Z(a,e.param.element)}),a._bind.forEach(function(e){Je(a,e.param.element||n,e)})),a},Ye=function(e,n){var r=t.renderModule(n);return r&&r.headless?e.runAsync().then(function(){return Ke(e,null,null,r.headless).renderAsync(e._scenegraph.root)}):Promise.reject("Unrecognized renderer type: "+n)},Ze=function(e){return e!==t.RenderType.Canvas&&e!==t.RenderType.SVG&&e!==t.RenderType.PNG?Promise.reject("Unrecognized image type: "+e):Ye(this,e).then(function(n){return e===t.RenderType.SVG?$(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")})},$e=function(){return Ye(this,t.RenderType.Canvas).then(function(e){return e.canvas()})},en=function(){return Ye(this,t.RenderType.SVG).then(function(e){return e.svg()})},nn=function(e,t,r){var i=r||a.functionContext;return o.parse(t,o.context(e,n.transforms,i))},tn=r.inherits(oe,n.Dataflow);tn.run=function(e){return n.Dataflow.prototype.run.call(this,e),(this._redraw||this._resize)&&this.render(),this},tn.render=function(){return this._renderer&&(this._resize&&(this._resize=0,P(this)),this._renderer.render(this._scenegraph.root)),this._redraw=!1,this},tn.dirty=function(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},tn.signal=function(e,n,t){var r=se(this,e);return 1===arguments.length?r.value:this.update(r,n,t)},tn.scenegraph=function(){return this._scenegraph},tn.background=function(e){return arguments.length?(this._background=e,this._resize=1,this):this._background},tn.width=function(e){return arguments.length?this.signal("width",e):this.signal("width")},tn.height=function(e){return arguments.length?this.signal("height",e):this.signal("height")},tn.padding=function(e){return arguments.length?this.signal("padding",e):this.signal("padding")},tn.renderer=function(e){return arguments.length?(t.renderModule(e)||this.error("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._renderer&&(this._renderer=null,this.initialize(this._el))),this):this._renderType},tn.loader=function(e){return arguments.length?(e!==this._loader&&(n.Dataflow.prototype.loader.call(this,e),this._renderer&&(this._renderer=null,this.initialize(this._el))),this):this._loader},tn.resize=function(){return this._autosize=1,this},tn.addEventListener=function(e,n){this._handler.on(e,n)},tn.removeEventListener=function(e,n){this._handler.off(e,n)},tn.addSignalListener=function(e,n){var t=se(this,e),r=function(){n(e,t.value)};this.on(t,null,(r.handler=n,r))},tn.removeSignalListener=function(e,n){var t=se(this,e),r=t._targets||[],i=r.filter(function(e){var t=e._update;return t&&t.handler===n});i.length&&r.remove(i[0])},tn.preventDefault=function(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},tn.tooltipHandler=function(e){var n=this._handler;return arguments.length?(n.handleTooltip=e||t.Handler.prototype.handleTooltip,this):n.handleTooltip},tn.events=Be,tn.finalize=Ge,tn.hover=Pe,tn.autosize=ne,tn.data=R,tn.change=O,tn.insert=U,tn.remove=q,tn.initialize=Xe,tn.toImageURL=Ze,tn.toCanvas=$e,tn.toSVG=en,tn.getState=te,tn.setState=ae,n.transform("Bound",s),n.transform("Mark",d),n.transform("Render",c),n.transform("ViewLayout",x),e.View=oe,Object.defineProperty(e,"__esModule",{value:!0})});