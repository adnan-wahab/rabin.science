!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-expression"),require("d3-color"),require("d3-array"),require("d3-format"),require("d3-time-format"),require("vega-scale"),require("vega-scenegraph"),require("vega-event-selector"),require("vega-dataflow")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-expression","d3-color","d3-array","d3-format","d3-time-format","vega-scale","vega-scenegraph","vega-event-selector","vega-dataflow"],t):t(e.vega=e.vega||{},e.vega,e.vega,e.d3,e.d3,e.d3,e.d3,e.vega,e.vega,e.vega,e.vega)}(this,function(e,t,n,r,a,i,o,l,s,u,d){"use strict";function c(e,n){t.error(e+' for "outer" push: '+t.stringValue(n))}function f(e){var t={};return function(n,r){return(t[r]||(t[r]=e(r)))(n)}}function p(e,t,n){return Ct.setMonth(e),Ct.setDate(t),At(Ct,n)}function g(e){return p(e,1,"%B")}function h(e){return p(e,1,"%b")}function m(e){return p(0,2+e,"%A")}function v(e){return p(0,2+e,"%a")}function y(e){return 1+~~(new Date(e).getMonth()/3)}function x(e){return 1+~~(new Date(e).getUTCMonth()/3)}function b(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function k(){return b(this.context.dataflow,"warn",arguments)}function S(){return b(this.context.dataflow,"info",arguments)}function R(){return b(this.context.dataflow,"debug",arguments)}function w(){return"Math.sqrt(Math.pow(event.touches[0].clientX - event.touches[1].clientX, 2) + Math.pow(event.touches[0].clientY - event.touches[1].clientY, 2))"}function z(){return"Math.atan2(event.touches[1].clientY - event.touches[0].clientY,event.touches[1].clientX - event.touches[0].clientX)"}function P(){return Bt?Bt.screen:{}}function O(){return Bt?[Bt.innerWidth,Bt.innerHeight]:[void 0,void 0]}function j(e,n){var r;return t.isFunction(e)?e:t.isString(e)?(r=n.scales[e])&&r.value:void 0}function $(e,t,n){var r=Xt+n;if(!t.hasOwnProperty(r))try{t[r]=e.scaleRef(n)}catch(e){}}function D(e,t,n,r){if(t[0].type===It)$(n,r,t[0].value);else if(t[0].type===Tt)for(e in n.scales)$(n,r,e)}function E(e,t){var n=j(e,(t||this).context);return n&&n.range?n.range():[]}function _(e,t){var n=j(e,(t||this).context);return n?n.domain():[]}function V(e,t){var n=j(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function F(e,t,n){return l.bandSpace(e||0,t||0,n||0)}function A(e,t){var n=j(e,(t||this).context);return n?n.copy():void 0}function M(e,t,n){var r=j(e,(n||this).context);return r?r(t):void 0}function W(e,n,r){var a=j(e,(r||this).context);return a?t.isArray(n)?(a.invertRange||a.invert)(n):(a.invert||a.invertExtent)(n):void 0}function C(e){return function(t,n,r){var a=j(t,(r||this).context);return a&&a.path[e](n)}}function L(e){var t=this.context.data[e];return t?t.values.value:[]}function q(e,n,r,a){n[0].type!==It&&t.error("First argument to data functions must be a string literal.");var i=n[0].value,o=Yt+i;a.hasOwnProperty(o)||(a[o]=r.getData(i).tuplesRef())}function B(e,t,n){var r=this.context.data[e]["index:"+t],a=r?r.value.get(n):void 0;return a?a.count:a}function U(e,n,r,a){n[0].type!==It&&t.error("First argument to indata must be a string literal."),n[1].type!==It&&t.error("Second argument to indata must be a string literal.");var i=n[0].value,o=n[1].value,l=Nt+o;a.hasOwnProperty(l)||(a[l]=r.getData(i).indataRef(r,o))}function I(e){return e.data}function T(e,t){var n=L.call(t,e);return n.root&&n.root.lookup||Qt}function N(e,t,n){var r=T(e,this),a=r[t],i=r[n];return a&&i?a.path(i).map(I):void 0}function X(e,t){var n=T(e,this)[t];return n?n.ancestors().map(I):void 0}function Y(e){return function(t){for(var n in e)if("_id"!==n&&t[n]!==e[n])return!1;return!0}}function H(e,n){for(var r=n.fields,a=n.values,i=n.getter||(n.getter=[]),o=r.length,l=0;l<o;++l)if(i[l]=i[l]||t.field(r[l]),i[l](e)!==a[l])return!1;return!0}function G(e,n){for(var r,a,i,o=n.intervals,l=o.length,s=0;s<l;++s){if(a=o[s].extent,r=o[s].getter||(o[s].getter=t.field(o[s].field)),i=r(e),!a||a[0]===a[1])return!0;if(t.isNumber(a[0])&&!Zt(i,a))return!1;if(t.isString(a[0])&&a.indexOf(i)<0)return!1}return!0}function J(e,t,n,r,a,i){for(var o,l,s=this.context.data[e],u=s?s.values.value:[],d=r!==nn,c=u.length,f=0;f<c;++f)if(o=u[f],l=t===o.unit,!(a===an&&l||a===rn&&!l)&&(l=i(n,o),d^l))return l;return!c||d}function K(e,t,n,r,a){return J.call(this,e,t,n,r,a,H)}function Q(e,t,n,r,a){return J.call(this,e,t,n,r,a,G)}function Z(e,t,n,r){for(var a,i,o,l,s=this.context.data[e],u=s?s.values.value:[],d={},c=0,f={},p=[],g=0,h=u.length;g<h;++g)a=u[g],i=a.unit,l=a.values[0],d[i]||(d[i]=++c),(t&&a.encodings[0]===t||n&&a.fields[0]===n)&&((o=f[l])||(f[l]=o={value:l,units:{},count:0}),o.units[i]||(o.units[i]=++o.count));for(l in f)r!==nn&&(o=f[l]).count!==c||p.push(o.value);return p.length?p:void 0}function ee(e,t,n,r){for(var a,i,o,l,s,u,d,c,f=r===nn?te:ne,p=this.context.data[e],g=p?p.values.value:[],h=0,m=g.length;h<m;++h)for(a=g[h].intervals,o=0,i=a.length;o<i;++o)l=a[o],(t&&l.encoding===t||n&&l.field===n)&&(s=l.extent,d=s[0],c=s[1],d>c&&(c=s[1],d=s[0]),u=u?f(u,d,c):[d,c]);return u&&u.length&&+u[0]!=+u[1]?u:void 0}function te(e,t,n){return e[0]>t&&(e[0]=t),e[1]<n&&(e[1]=n),e}function ne(e,t,n){return n<e[0]||e[1]<t?[]:(e[0]<t&&(e[0]=t),e[1]>n&&(e[1]=n),e)}function re(e,t,n){return 1===arguments.length?on[e]:(on[e]=t,n&&(dn[e]=n),fn&&(fn.functions[e]=un+e),this)}function ae(e){var t=n.functions(e);ln.forEach(function(e){t[e]=sn+e});for(var r in on)t[r]=un+r;return t}function ie(e){return e===hn?gn:e||gn}function oe(e,n){return(e.merge?le:e.stream?se:e.type?ue:t.error("Invalid stream specification: "+t.stringValue(e)))(e,n)}function le(e,t){var n=e.merge.map(function(e){return oe(e,t)}),r=de({merge:n},e,t);return t.addStream(r).id}function se(e,t){var n=oe(e.stream,t),r=de({stream:n},e,t);return t.addStream(r).id}function ue(e,t){var n=t.event(ie(e.source),e.type),r=de({stream:n},e,t);return 1===Object.keys(r).length?n:t.addStream(r).id}function de(e,n,r){var a=n.between;return a&&(2!==a.length&&t.error('Stream "between" parameter must have 2 entries: '+t.stringValue(n)),e.between=[oe(a[0],r),oe(a[1],r)]),a=n.filter?t.array(n.filter):[],(n.marktype||n.markname||n.markrole)&&a.push(ce(n.marktype,n.markname,n.markrole)),n.source===hn&&a.push("inScope(event.item)"),a.length&&(e.filter=pn("("+a.join(")&&(")+")").$expr),null!=(a=n.throttle)&&(e.throttle=+a),null!=(a=n.debounce)&&(e.debounce=+a),n.consume&&(e.consume=!0),e}function ce(e,t,n){var r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}function fe(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function pe(e,t,n,r){return new fe(e,t,n,r)}function ge(e,t){return pe("Operator",e,t)}function he(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function me(e,t){return t?{$field:e,$name:t}:{$field:e}}function ve(e,t){return{$compare:e,$order:t}}function ye(e){return{$key:e}}function xe(e){return t.isObject(e)?(e.order===kn?"-":"+")+be(e.op,e.field):""}function be(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}function ke(e){return e&&e.signal}function Se(e){return function(t,n,r){return pe(e,n,t||void 0,r)}}function Re(e){return Jn.hasOwnProperty(e)}function we(e){return"quantile"===e}function ze(e,n){var r=e.type||"linear";Gn.hasOwnProperty(r)||t.error("Unrecognized scale type: "+t.stringValue(r)),n.addScale(e.name,{type:r,domain:void 0})}function Pe(e,t){var n,r=t.getScale(e.name).params;r.domain=De(e.domain,e,t),null!=e.range&&(r.range=qe(e,t,r)),null!=e.interpolate&&Le(e.interpolate,r);for(n in e)r.hasOwnProperty(n)||"name"===n||(r[n]=Oe(e[n],t))}function Oe(e,n){return t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported object: "+t.stringValue(e)):e}function je(e,t){return e.signal?t.signalRef(e.signal):e.map(function(e){return Oe(e,t)})}function $e(e){t.error("Can not find data set: "+t.stringValue(e))}function De(e,n,r){return e?e.signal?r.signalRef(e.signal):(t.isArray(e)?Ee:e.fields?Ve:_e)(e,n,r):void(null==n.domainMin&&null==n.domainMax||t.error("No scale domain defined for domainMin/domainMax to override."))}function Ee(e,t,n){return e.map(function(e){return Oe(e,n)})}function _e(e,t,n){var r=n.getData(e.data);return r||$e(e.data),Re(t.type)?r.valuesRef(n,e.field,Me(e.sort,!1)):we(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function Ve(e,n,r){var a=e.data,i=e.fields.reduce(function(e,n){return n=t.isString(n)?{data:a,field:n}:t.isArray(n)||n.signal?Fe(n,r):n,e.push(n),e},[]);return(Re(n.type)?Ae:we(n.type)?We:Ce)(e,r,i)}function Fe(e,n){var r="_:vega:_"+Yn++,a=zn({});return t.isArray(e)?a.value={$ingest:e}:e.signal&&n.signalRef("modify("+t.stringValue(r)+","+e.signal+", true)"),n.addDataPipeline(r,[a,In({})]),{data:r,field:"data"}}function Ae(e,t,n){var r,a,i,o;return r=n.map(function(e){var n=t.getData(e.data);return n||$e(e.data),n.countsRef(t,e.field)}),a=t.add(Sn({groupby:bn,ops:["sum"],fields:[t.fieldRef("count")],as:["count"],pulse:r})),i=t.add(zn({pulse:he(a)})),o=t.add(Xn({field:bn,sort:t.sortRef(Me(e.sort,!0)),pulse:he(i)})),he(o)}function Me(e,n){return e&&(e.field||e.op?e.field||"count"===e.op?n&&e.field?t.error("Multiple domain scales can not sort by field."):n&&e.op&&"count"!==e.op&&t.error("Multiple domain scales support op count only."):t.error("No field provided for sort aggregate op: "+e.op):t.isObject(e)?e.field="key":e={field:"key"}),e}function We(e,t,n){var r=n.map(function(e){var n=t.getData(e.data);return n||$e(e.data),n.domainRef(t,e.field)});return he(t.add(An({values:r})))}function Ce(e,t,n){var r=n.map(function(e){var n=t.getData(e.data);return n||$e(e.data),n.extentRef(t,e.field)});return he(t.add(Fn({extents:r})))}function Le(e,t){t.interpolate=Oe(e.type||e),null!=e.gamma&&(t.interpolateGamma=Oe(e.gamma))}function qe(e,n,r){var a=e.range,i=n.config.range;if(a.signal)return n.signalRef(a.signal);if(t.isString(a)){if(i&&i.hasOwnProperty(a))return e=t.extend({},e,{range:i[a]}),qe(e,n,r);"width"===a?a=[0,{signal:"width"}]:"height"===a?a=Re(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t.error("Unrecognized scale range value: "+t.stringValue(a))}else{if(a.scheme)return r.scheme=Oe(a.scheme,n),a.extent&&(r.schemeExtent=je(a.extent,n)),void(a.count&&(r.schemeCount=Oe(a.count,n)));if(a.step)return void(r.rangeStep=Oe(a.step,n));if(Re(e.type)&&!t.isArray(a))return De(a,e,n);t.isArray(a)||t.error("Unsupported range type: "+t.stringValue(a))}return a.map(function(e){return Oe(e,n)})}function Be(e,n){return t.isArray(e)?e.map(function(e){return Be(e,n)}):t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported parameter object: "+t.stringValue(e)):e}function Ue(e,n,r,a){var i,o,l;if(e.signal)i="datum",l=nr(e.signal,n,r,a);else if(e.group||e.parent){for(o=Math.max(1,e.level||1),i="item";o-- >0;)i+=".mark.group";e.parent?(l=e.parent,i+=".datum"):l=e.group}else e.datum?(i="datum",l=e.datum):t.error("Invalid field reference: "+t.stringValue(e));return e.signal||(t.isString(l)?(a[l]=1,l=t.splitAccessPath(l).map(t.stringValue).join("][")):l=Ue(l,n,r,a)),i+"["+l+"]"}function Ie(e,n){if(!t.isString(e))return-1;var r=n.scaleType(e);return"band"===r||"point"===r?1:0}function Te(e,n,r,a){var i;if(t.isString(e))i=Xt+e,r.hasOwnProperty(i)||(r[i]=n.scaleRef(e)),i=t.stringValue(i);else{for(i in n.scales)r[Xt+i]=n.scaleRef(i);i=t.stringValue(Xt)+"+"+(e.signal?"("+nr(e.signal,n,r,a)+")":rr(e,n,r,a))}return"_["+i+"]"}function Ne(e,n,r,a){var i,o,l,s={},u="var o=item,datum=o.datum,$;";for(i in e)o=e[i],t.isArray(o)?u+=ur(i,o,a,r,s):(l=lr(i,o,a,r,s),u+=sr("o",i,l));return u+=er(e,n),u+="return 1;",{$expr:u,$fields:Object.keys(s),$output:Object.keys(e)}}function Xe(e){return t.isObject(e)?e:{value:e}}function Ye(e,t,n){return null!=n?(e[t]={value:n},1):0}function He(e,n,r){for(var a in n)r&&r.hasOwnProperty(a)||(e[a]=t.extend(e[a]||{},n[a]));return e}function Ge(e,t,n,r,a){var i,o;a=a||{},a.encoders={$encode:i={}},e=Je(e,t,n,r.config);for(o in e)i[o]=Ne(e[o],t,a,r);return a}function Je(e,n,r,a){var i,o;"legend"!=r&&0!==String(r).indexOf("axis")||(r=null),a=r===cr?a.group:r===dr||a[n=r]?t.extend({},a.mark,a[n]):{},i={};for(o in a)Ke(o,e)||("fill"===o||"stroke"===o)&&(Ke("fill",e)||Ke("stroke",e))||(i[o]={value:a[o]});return e=t.extend({},e),e.enter=t.extend(i,e.enter),e}function Ke(e,t){return t.enter&&t.enter[e]||t.update&&t.update[e]}function Qe(e,t,n){var r,a,i,o={};for(a=0,i=e.params.length;a<i;++a)r=e.params[a],o[r.name]=Ze(r,t,n);return o}function Ze(e,n,r){var a=e.type,i=n[e.name];return"index"===a?tt(e,n,r):void 0===i?void(e.required&&t.error("Missing required "+t.stringValue(n.type)+" parameter: "+t.stringValue(e.name))):"param"===a?nt(e,n,r):"projection"===a?r.projectionRef(n[e.name]):e.array&&!ke(i)?i.map(function(t){return et(e,t,r)}):et(e,i,r)}function et(e,n,r){var a=e.type;if(ke(n))return lt(a)?t.error("Expression references can not be signals."):st(a)?r.fieldRef(n):ut(a)?r.compareRef(n):r.signalRef(n.signal);var i=e.expr||st(a);return i&&at(n)?pn(n.expr,r):i&&it(n)?me(n.field):lt(a)?pn(n,r):ot(a)?he(r.getData(n).values):st(a)?me(n):ut(a)?r.compareRef(n):n}function tt(e,n,r){return t.isString(n.from)||t.error('Lookup "from" parameter must be a string literal.'),r.getData(n.from).lookupRef(r,n.key)}function nt(e,n,r){var a=n[e.name];return e.array?(t.isArray(a)||t.error("Expected an array of sub-parameters. Instead: "+t.stringValue(a)),a.map(function(t){return rt(e,t,r)})):rt(e,a,r)}function rt(e,n,r){var a,i,o,l,s;for(l=0,s=e.params.length;l<s;++l){i=e.params[l];for(o in i.key)if(i.key[o]!==n[o]){i=null;break}if(i)break}return i||t.error("Unsupported parameter: "+t.stringValue(n)),a=t.extend(Qe(i,n,r),i.key),he(r.add(Mn(a)))}function at(e){return e&&e.expr}function it(e){return e&&e.field}function ot(e){return"data"===e}function lt(e){return"expr"===e}function st(e){return"field"===e}function ut(e){return"compare"===e}function dt(e,t,n,r,a){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=a,this.index={}}function ct(e){return t.isString(e)?e:null}function ft(e,t,n){var r,a=be(n.op,n.field);if(t.ops){for(var i=0,o=t.as.length;i<o;++i)if(t.as[i]===a)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(a))}function pt(e,t,n,r,a,i,o){var l,s,u=t[n]||(t[n]={}),d=xe(i),c=ct(a);if(null!=c&&(e=t.scope,c+=d?"|"+d:"",l=u[c]),!l){var f=i?{field:bn,pulse:t.countsRef(e,a,i)}:{field:e.fieldRef(a),pulse:he(t.output)};d&&(f.sort=e.sortRef(i)),s=e.add(pe(r,void 0,f)),o&&(t.index[a]=s),l=he(s),null!=c&&(u[c]=l)}return l}function gt(e,t){return null!=e?e:t}function ht(e,t,n){var r,a=+t.symbolSize;return r=n&&n.update&&n.update.fontSize,r||(r=n&&n.enter&&n.enter.fontSize),r&&(r=r.value),r||(r=+t.labelFontSize),e.size?{$expr:"Math.max(Math.ceil(Math.sqrt(_.scale(datum))),"+r+")"}:Math.max(Math.ceil(Math.sqrt(a)),r)}function mt(e){var t={};return Ye(t,"fill",e.fillColor)+Ye(t,"stroke",e.strokeColor)+Ye(t,"strokeWidth",e.strokeWidth)+Ye(t,"strokeDash",e.strokeDash)+Ye(t,"cornerRadius",e.cornerRadius)?t:void 0}function vt(e,n,r,a){var i,o,l,s,u,d,c=e.text,f=e.orient||n.orient,p=e.anchor||n.anchor,g=f===xr||f===yr?-1:1,h=f===yr||f===br,m={group:h?"width":"height"},v={};return v.enter=i={opacity:{value:0}},Ye(i,"fill",n.color),Ye(i,"font",n.font),Ye(i,"fontSize",n.fontSize),Ye(i,"fontWeight",n.fontWeight),v.exit={opacity:{value:0}},v.update=o={opacity:{value:1},text:t.isObject(c)?c:{value:c+""},offset:Xe(e.offset||0)},"start"===p?(u=0,d="left"):"end"===p?(u=1,d="right"):(u=.5,d="center"),l={field:m,mult:u},s=g<0?{value:0}:h?{field:{group:"height"}}:{field:{group:"width"}},h?(o.x=l,o.y=s,o.angle={value:0},o.baseline={value:f===yr?"bottom":"top"}):(o.x=s,o.y=l,o.angle={value:90*g},o.baseline={value:"bottom"}),o.align={value:d},o.limit={field:m},Ye(o,"angle",n.angle),Ye(o,"baseline",n.baseline),Ye(o,"limit",n.limit),gr(mr,fr,null,a,v,r)}function yt(e,t){var n=[];e.transform&&e.transform.forEach(function(e){n.push(Er(e,t))}),e.on&&e.on.forEach(function(n){Mr(n,t,e.name)}),t.addDataPipeline(e.name,xt(e,t,n))}function xt(e,t,n){var r,a,i,o,l,s=[],u=null,d=!1,c=!1;for(e.values?s.push(u=bt({$ingest:e.values,$format:e.format})):e.url?s.push(u=bt({$request:e.url,$format:e.format})):e.source&&(r=t.getData(e.source),u=r.output,s.push(null)),a=0,i=n.length;a<i;++a)o=n[a],l=o.metadata,u||l.source||s.push(u=bt()),s.push(o),l.generates&&(c=!0),l.modifies&&!c&&(d=!0),l.source?u=o:l.changes&&(u=null);return r&&(s[0]=qn({derive:d,pulse:he(r.output)}),d&&s.splice(1,0,bt())),u||s.push(bt()),s.push(In({})),s}function bt(e){var t=zn({},e);return t.metadata={source:!0},t}function kt(e,t){return{scale:e.scale,range:t}}function St(e,n){var r,a,i,o,l,s=n.config;return n.background=e.background||s.background,l=he(n.root=n.add(ge())),n.addSignal("width",e.width||-1),n.addSignal("height",e.height||-1),n.addSignal("padding",Dt(e.padding,s)),t.array(e.signals).forEach(function(e){Hr[e.name]||_t(e,n)}),a=n.add(zn()),i=He({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),i=n.add(jn(Ge(i,hr,cr,n,{pulse:he(a)}))),o=n.add(Nn({layout:n.objectProperty(e.layout),legendMargin:s.legendMargin,autosize:$t(e.autosize,s),mark:l,pulse:he(i)})),n.operators.pop(),n.pushState(he(i),he(o),null),Yr(e,n,!0),n.operators.push(o),r=n.add(wn({mark:l,pulse:he(o)})),r=n.add(Bn({pulse:he(r)})),r=n.add(In({pulse:he(r)})),n.addData("root",new dt(n,a,a,r)),n}function Rt(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.background=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function wt(e){this.config=e.config,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function zt(e){return(t.isArray(e)?Pt:Ot)(e)}function Pt(e){for(var n,r="[",a=0,i=e.length;a<i;++a)n=e[a],r+=(a>0?",":"")+(t.isObject(n)?n.signal||zt(n):t.stringValue(n));return r+"]"}function Ot(e){var n,r,a="{",i=0;for(n in e)r=e[n],a+=(++i>1?",":"")+t.stringValue(n)+":"+(t.isObject(r)?r.signal||zt(r):t.stringValue(r));return a+"}"}function jt(){return{padding:0,autosize:"pad",background:null,group:null,mark:null,arc:{fill:Zr},area:{fill:Zr},image:null,line:{stroke:Zr,strokeWidth:Qr},path:{stroke:Zr},rect:{fill:Zr},rule:{stroke:ea},shape:{stroke:Zr},symbol:{fill:Zr,size:64},text:{fill:ea,font:"sans-serif",fontSize:11},point:{size:Kr,strokeWidth:Qr,shape:"circle"},circle:{size:Kr,strokeWidth:Qr},square:{size:Kr,strokeWidth:Qr},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:ea,grid:!1,gridWidth:1,gridColor:na,gridDash:[],gridOpacity:1,labels:!0,labelAngle:0,labelColor:ea,labelFont:"sans-serif",labelFontSize:10,labelPadding:2,labelLimit:180,ticks:!0,tickRound:!0,tickSize:5,tickWidth:1,tickColor:ea,titleAlign:"center",titlePadding:2,titleColor:ea,titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},legend:{orient:"right",offset:18,padding:0,entryPadding:5,titlePadding:5,gradientWidth:100,gradientHeight:20,gradientStrokeColor:na,gradientStrokeWidth:0,gradientLabelBaseline:"top",gradientLabelOffset:2,labelColor:ea,labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,labelLimit:160,symbolType:"circle",symbolSize:100,symbolColor:ta,symbolStrokeWidth:1.5,titleColor:ea,titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleAlign:"left",titleBaseline:"top",titleLimit:180},title:{orient:"top",anchor:"middle",offset:2,color:ea,font:"sans-serif",fontSize:13,fontWeight:"bold"},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues",extent:[.2,1]},heatmap:{scheme:"viridis"},ramp:{scheme:"blues",extent:[.2,1]},diverging:{scheme:"blueorange"},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}var $t=function(e,n){return e=e||n.autosize,t.isObject(e)?e:(e=e||"pad",{type:e})},Dt=function(e,n){return e=e||n.padding,t.isObject(e)?e:(e=+e||0,{top:e,bottom:e,left:e,right:e})},Et=["value","update","react","bind"],_t=function(e,t){var n=e.name;if("outer"===e.push)t.signals[n]||c("No prior signal definition",n),Et.forEach(function(t){void 0!==e[t]&&c("Invalid property ",t)});else{var r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}},Vt=f(i.format),Ft=f(o.utcFormat),At=f(o.timeFormat),Mt=f(o.utcParse),Wt=f(o.timeParse),Ct=new Date(2e3,0,1),Lt=function(e){var t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},qt=function(e,t,n){var r,a=e[0],i=e[1];return i<a&&(r=i,i=a,a=r),r=i-a,r>=n-t?[t,n]:[Math.min(Math.max(a,t),n-r),Math.min(Math.max(i,r),n)]},Bt="undefined"!=typeof window&&window||null,Ut=function(e){return e[e.length-1]-e[0]||0},It="Literal",Tt="Identifier",Nt="@",Xt="%",Yt=":",Ht=function(e,t,n,r){var a=s.Gradient(t,n),i=e.domain(),o=i[0],u=i[i.length-1],d=l.scaleFraction(e,o,u);e.ticks&&(i=e.ticks(+r||15),o!==i[0]&&i.unshift(o),u!==i[i.length-1]&&i.push(u));for(var c=0,f=i.length;c<f;++c)a.stop(d(i[c]),e(i[c]));return a},Gt=C("area"),Jt=C("bounds"),Kt=C("centroid"),Qt={},Zt=function(e,t){var n,r=t[0],a=t[t.length-1];return r>a&&(n=r,r=a,a=n),r<=e&&e<=a},en=function(e,t,n){if(e){var r=this.context.dataflow,a=e.mark.source;r.pulse(a,r.changeset().encode(e,t))}return void 0!==n?n:e},tn=function(e,n,r,a,i,o){var l,s,u=this.context.dataflow,d=this.context.data[e],c=d.input,f=d.changes,p=u.stamp();if(!1===u._trigger||!(c.value.length||n||a))return 0;if((!f||f.stamp<p)&&(d.changes=f=u.changeset(),f.stamp=p,u.runAfter(function(){d.modified=!0,u.pulse(c,f).run()})),r&&(l=!0===r?t.truthy:t.isArray(r)||null!=r._id?r:Y(r),f.remove(l)),n&&f.insert(n),a&&(l=Y(a),c.value.some(l)?f.remove(l):f.insert(a)),i)for(s in o)f.modify(i,s,o[s]);return 1},nn="union",rn="unit",an="others",on={isArray:t.isArray,isBoolean:t.isBoolean,isDate:t.isDate,isNumber:t.isNumber,isObject:t.isObject,isRegExp:t.isRegExp,isString:t.isString,toBoolean:t.toBoolean,toDate:t.toDate,toNumber:t.toNumber,toString:t.toString,pad:t.pad,truncate:t.truncate,rgb:r.rgb,lab:r.lab,hcl:r.hcl,hsl:r.hsl,sequence:a.range,format:Vt,utcFormat:Ft,utcParse:Mt,timeFormat:At,timeParse:Wt,monthFormat:g,monthAbbrevFormat:h,dayFormat:m,dayAbbrevFormat:v,quarter:y,utcquarter:x,warn:k,info:S,debug:R,inScope:Lt,clampRange:qt,pinchDistance:w,pinchAngle:z,screen:P,windowsize:O,span:Ut,bandspace:F,inrange:Zt,encode:en,modify:tn},ln=["view","item","group","xy","x","y"],sn="event.vega.",un="this.",dn={};re("bandwidth",V,D),re("copy",A,D),re("domain",_,D),re("range",E,D),re("invert",W,D),re("scale",M,D),re("gradient",Ht,D),re("geoArea",Gt,D),re("geoBounds",Jt,D),re("geoCentroid",Kt,D),re("indata",B,U),re("data",L,q),re("vlPoint",K,q),re("vlInterval",Q,q),re("vlPointDomain",Z,q),re("vlIntervalDomain",ee,q),re("treePath",N,q),re("treeAncestors",X,q);var cn={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_["+t.stringValue("$"+e)+"]"},functions:ae,constants:n.constants,visitors:dn},fn=n.codegen(cn),pn=function(e,r,a){var i,o,l={};try{i=n.parse(e)}catch(n){t.error("Expression parse error: "+t.stringValue(e))}return i.visit(function(e){if("CallExpression"===e.type){var t=e.callee.name,n=cn.visitors[t];n&&n(t,e.arguments,r,l)}}),o=fn(i),o.globals.forEach(function(e){var t="$"+e;!l.hasOwnProperty(t)&&r.getSignal(e)&&(l[t]=r.signalRef(e))}),{$expr:a?a+"return("+o.code+");":o.code,$fields:o.fields,$params:l}},gn="view",hn="scope",mn=function(e,t){return e.signal?t.getSignal(e.signal).id:oe(e,t)},vn="var datum=event.item&&event.item.datum;",yn=function(e,n,r){var a,i=e.events,o=e.update,l=e.encode,s=[],d="";i||t.error("Signal update missing events specification."),t.isString(i)&&(i=u.selector(i)),i=t.array(i).filter(function(e){return e.signal?(s.push(e),0):1}),i.length&&s.push(i.length>1?{merge:i}:i[0]),null!=l&&(o&&t.error("Signal encode and update are mutually exclusive."),o="encode(item(),"+t.stringValue(l)+")"),d=t.isString(o)?pn(o,n,vn):null!=o.expr?pn(o.expr,n,vn):null!=o.value?o.value:null!=o.signal?{$expr:"_.value",$params:{value:n.signalRef(o.signal)}}:t.error("Invalid signal update specification."),a={target:r,update:d},e.force&&(a.options={force:!0}),s.forEach(function(e){e={source:mn(e,n)},n.addUpdate(t.extend(e,a))})},xn=function(e,t){var n=t.getSignal(e.name);if(e.update){var r=pn(e.update,t);n.update=r.$expr,n.params=r.$params}e.on&&e.on.forEach(function(e){yn(e,t,n.id)})},bn=me("key"),kn="descending",Sn=Se("Aggregate"),Rn=Se("AxisTicks"),wn=Se("Bound"),zn=Se("Collect"),Pn=Se("Compare"),On=Se("DataJoin"),jn=Se("Encode"),$n=Se("Facet"),Dn=Se("Field"),En=Se("Key"),_n=Se("LegendEntries"),Vn=Se("Mark"),Fn=Se("MultiExtent"),An=Se("MultiValues"),Mn=Se("Params"),Wn=Se("PreFacet"),Cn=Se("Projection"),Ln=Se("Proxy"),qn=Se("Relay"),Bn=Se("Render"),Un=Se("Scale"),In=Se("Sieve"),Tn=Se("SortItems"),Nn=Se("ViewLayout"),Xn=Se("Values"),Yn=0,Hn=["identity","ordinal","band","point","bin-linear","bin-ordinal","linear","pow","sqrt","log","sequential","time","utc","quantize","quantile","threshold"],Gn=t.toSet(Hn),Jn=t.toSet(Hn.slice(1,6)),Kn=function(e,t){var n={};for(var r in e)"name"!==r&&(n[r]=Be(e[r],t));t.addProjection(e.name,n)},Qn=t.toSet(["rule"]),Zn=t.toSet(["group","image","rect"]),er=function(e,t){var n="";return Qn[t]?n:(e.x2&&(e.x?(Zn[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):e.width?n+="o.x=o.x2-o.width;":n+="o.x=o.x2;"),e.xc&&(e.width?n+="o.x=o.xc-o.width/2;":n+="o.x=o.xc;"),e.y2&&(e.y?(Zn[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):e.height?n+="o.y=o.y2-o.height;":n+="o.y=o.y2;"),e.yc&&(e.height?n+="o.y=o.yc-o.height/2;":n+="o.y=o.yc;"),n)},tr=function(e,t,n,r){function a(e,a,i,o){return"this."+e+"("+[lr(null,a,t,n,r),lr(null,i,t,n,r),lr(null,o,t,n,r)].join(",")+").toString()"}return e.c?a("hcl",e.h,e.c,e.l):e.h||e.s?a("hsl",e.h,e.s,e.l):e.l||e.a?a("lab",e.l,e.a,e.b):e.r||e.g||e.b?a("rgb",e.r,e.g,e.b):null},nr=function(e,n,r,a){var i=pn(e,n);return i.$fields.forEach(function(e){a[e]=1}),t.extend(r,i.$params),i.$expr},rr=function(e,n,r,a){return Ue(t.isObject(e)?e:{datum:e},n,r,a)},ar=function(e,t,n,r,a){var i,o,l,s=Te(e.scale,n,r,a);return null!=e.range?(i=+e.range,o=s+".range()",t=0===i?o+"[0]":"($="+o+","+(1===i?"$[$.length-1]":"$[0]+"+i+"*($[$.length-1]-$[0])")+")"):(void 0!==t&&(t=s+"("+t+")"),e.band&&(l=Ie(e.scale,n))&&(o=s+".bandwidth",i=+e.band,i=o+"()"+(1===i?"":"*"+i),l<0&&(i="("+o+"?"+i+":0)"),t=(t?t+"+":"")+i,e.extra&&(t="(datum.extra?"+s+"(datum.extra.value):"+t+")")),null==t&&(t="0")),t},ir=function(e,n,r,a){return"this.gradient("+Te(e.gradient,n,r,a)+","+t.stringValue(e.start)+","+t.stringValue(e.stop)+","+t.stringValue(e.count)+")"},or=function(e,n,r,a){return t.isObject(e)?"("+lr(null,e,n,r,a)+")":e},lr=function(e,n,r,a,i){if(null!=n.gradient)return ir(n,r,a,i);var o=n.signal?nr(n.signal,r,a,i):n.color?tr(n.color,r,a,i):null!=n.field?rr(n.field,r,a,i):void 0!==n.value?t.stringValue(n.value):void 0;return null!=n.scale&&(o=ar(n,o,r,a,i)),void 0===o&&(o=null),null!=n.exponent&&(o="Math.pow("+o+","+or(n.exponent,r,a,i)+")"),null!=n.mult&&(o+="*"+or(n.mult,r,a,i)),null!=n.offset&&(o+="+"+or(n.offset,r,a,i)),n.round&&(o="Math.round("+o+")"),o},sr=function(e,n,r){return e+"["+t.stringValue(n)+"]="+r+";"},ur=function(e,t,n,r,a){var i="";return t.forEach(function(t){var o=lr(e,t,n,r,a);i+=t.test?nr(t.test,n,r,a)+"?"+o+":":o}),sr("o",e,i)},dr="mark",cr="frame",fr="title",pr={name:1,interactive:1},gr=function(e,t,n,r,a,i){return{type:e,name:i?i.name:void 0,role:t,key:n,from:r,interactive:!(!i||!i.interactive),encode:He(a,i,pr)}},hr="group",mr="text",vr=function(e,t,n){var r,a,i={value:0},o={};return o.enter=r={opacity:i,x:i,y:i},Ye(r,"width",t.gradientWidth),Ye(r,"height",t.gradientHeight),Ye(r,"stroke",t.gradientStrokeColor),Ye(r,"strokeWidth",t.gradientStrokeWidth),o.exit={opacity:i},o.update=a={x:i,y:i,fill:{gradient:e},opacity:{value:1}},Ye(a,"width",t.gradientWidth),Ye(a,"height",t.gradientHeight),gr("rect","legend-gradient",void 0,void 0,o,n)},yr="top",xr="left",br="bottom",kr="value",Sr=["shape","size","fill","stroke","strokeDash","opacity"],Rr=function(e,t,n,r){var a,i,o={value:0},l={};return l.enter=a={opacity:o,text:{field:"label"}},Ye(a,"fill",t.labelColor),Ye(a,"font",t.labelFont),Ye(a,"fontSize",t.labelFontSize),Ye(a,"baseline",t.gradientLabelBaseline),Ye(a,"limit",t.gradientLabelLimit),l.exit={opacity:o},l.update=i={opacity:{value:1}},a.x=i.x={field:"perc",mult:t.gradientWidth},a.y=i.y={value:t.gradientHeight,offset:t.gradientLabelOffset},a.align=i.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},gr(mr,"legend-label","perc",r,l,n)},wr=function(e,t,n,r){var a,i,o={value:0},l={};return l.enter=a={opacity:o,text:{field:"label"}},Ye(a,"align",t.labelAlign),Ye(a,"baseline",t.labelBaseline),Ye(a,"fill",t.labelColor),Ye(a,"font",t.labelFont),Ye(a,"fontSize",t.labelFontSize),Ye(a,"limit",t.labelLimit),l.exit={opacity:o},l.update=i={opacity:{value:1}},a.x=i.x={field:"offset",offset:t.labelOffset},a.y=i.y={field:"size",mult:.5,offset:{field:"total",offset:{field:{group:"entryPadding"},mult:{field:"index"}}}},gr(mr,"legend-label",kr,r,l,n)},zr=function(e,t,n,r){var a,i,o={value:0},l={};return l.enter=a={opacity:o},Ye(a,"shape",t.symbolType),Ye(a,"size",t.symbolSize),Ye(a,"strokeWidth",t.symbolStrokeWidth),e.fill||Ye(a,"stroke",t.symbolColor),l.exit={opacity:o},l.update=i={opacity:{value:1}},a.x=i.x={field:"offset",mult:.5},a.y=i.y={field:"size",mult:.5,offset:{field:"total",offset:{field:{group:"entryPadding"},mult:{field:"index"}}}},Sr.forEach(function(t){e[t]&&(i[t]=a[t]={scale:e[t],field:kr})}),gr("symbol","legend-symbol",kr,r,l,n)},Pr=function(e,t,n,r){var a,i={value:0},o=e.title,l={};return l.enter=a={x:{field:{group:"padding"}},y:{field:{group:"padding"}},opacity:i},Ye(a,"align",t.titleAlign),Ye(a,"baseline",t.titleBaseline),Ye(a,"fill",t.titleColor),Ye(a,"font",t.titleFont),Ye(a,"fontSize",t.titleFontSize),Ye(a,"fontWeight",t.titleFontWeight),Ye(a,"limit",t.titleLimit),l.exit={opacity:i},l.update={opacity:{value:1},text:o&&o.signal?{signal:o.signal}:{value:o+""}},gr(mr,"legend-title",null,r,l,n)},Or=function(e,t,n,r,a,i){return{type:hr,name:t,role:e,from:n,interactive:r,encode:a,marks:i}},jr=function(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")?e.type===hr?"scope":t||dr:t},$r=function(e){return{clip:e.clip||!1,interactive:!1!==e.interactive,marktype:e.type,name:e.name||void 0,role:e.role||jr(e),zindex:+e.zindex||void 0}},Dr=function(e){return e},Er=function(e,n){var r=d.definition(e.type);r||t.error("Unrecognized transform type: "+t.stringValue(e.type));var a=pe(r.type,null,Qe(r,e,n));return e.signal&&n.addSignal(e.signal,n.proxy(a)),a.metadata=r.metadata||{},a},_r=function(e,n,r){var a,i,o,l,s;return e?(a=e.facet)&&(n||t.error("Only group marks can be faceted."),null!=a.field?l=s=he(r.getData(a.data).output):(i=r.keyRef(a.groupby),e.data?s=he(r.getData(e.data).aggregate):(o=Er(t.extend({type:"aggregate",groupby:t.array(a.groupby)},a.aggregate)),o.params.key=i,o.params.pulse=he(r.getData(a.data).output),l=s=he(r.add(o))))):l=he(r.add(zn(null,[{}]))),l||(l=e.$ref?e:he(e.mark?r.getData(Dr(e.mark)).output:r.getData(e.data).output)),{key:i,pulse:l,parent:s}};dt.fromEntries=function(e,t){var n=t.length,r=1,a=t[0],i=t[n-1],o=t[n-2],l=null
;for(e.add(t[0]);r<n;++r)t[r].params.pulse=he(t[r-1]),e.add(t[r]),"Aggregate"===t[r].type&&(l=t[r]);return new dt(e,a,o,i,l)};var Vr=dt.prototype;Vr.countsRef=function(e,t,n){var r,a,i,o=this,l=o.counts||(o.counts={}),s=ct(t);return null!=s&&(e=o.scope,r=l[s]),r?n&&n.field&&ft(e,r.agg.params,n):(i={groupby:e.fieldRef(t,"key"),pulse:he(o.output)},n&&n.field&&ft(e,i,n),a=e.add(Sn(i)),r=e.add(zn({pulse:he(a)})),r={agg:a,ref:he(r)},null!=s&&(l[s]=r)),r.ref},Vr.tuplesRef=function(){return he(this.values)},Vr.extentRef=function(e,t){return pt(e,this,"extent","Extent",t,!1)},Vr.domainRef=function(e,t){return pt(e,this,"domain","Values",t,!1)},Vr.valuesRef=function(e,t,n){return pt(e,this,"vals","Values",t,n||!0)},Vr.lookupRef=function(e,t){return pt(e,this,"lookup","TupleIndex",t,!1)},Vr.indataRef=function(e,t){return pt(e,this,"indata","TupleIndex",t,!0,!0)};var Fr=function(e,n,r){var a,i,o,l,s=e.from.facet,u=s.name,d=he(n.getData(s.data).output);s.name||t.error("Facet must have a name: "+t.stringValue(s)),s.data||t.error("Facet must reference a data set: "+t.stringValue(s)),s.field?l=n.add(Wn({field:n.fieldRef(s.field),pulse:d})):s.groupby?l=n.add($n({key:n.keyRef(s.groupby),group:he(n.proxy(r.parent)),pulse:d})):t.error("Facet must specify groupby or field: "+t.stringValue(s)),a=n.fork(),i=a.add(zn()),o=a.add(In({pulse:he(i)})),a.addData(u,new dt(a,i,i,o)),a.addSignal("parent",null),l.params.subflow={$subflow:Yr(e,a).toRuntime()}},Ar=function(e,t,n){var r=t.add(Wn({pulse:n.pulse})),a=t.fork();a.add(In()),a.addSignal("parent",null),r.params.subflow={$subflow:Yr(e,a).toRuntime()}},Mr=function(e,t,n){var r,a,i=e.remove,o=e.insert,l=e.toggle,s=e.modify,u=e.values,d=t.add(ge());r="if("+e.trigger+',modify("'+n+'",'+[o,i,l,s,u].map(function(e){return null==e?"null":e}).join(",")+"),0)",a=pn(r,t),d.update=a.$expr,d.params=a.$params},Wr=function(e,n){var r,a,i,o,l,s,u,d,c,f,p,g,h,m=jr(e),v=e.type===hr,y=e.from&&e.from.facet,x=e.layout||"scope"===m||m===cr,b=m===dr||x||y;i=_r(e.from,v,n),a=n.add(On({key:i.key||(e.key?me(e.key):void 0),pulse:i.pulse,clean:!v})),c=he(a),a=o=n.add(zn({pulse:c})),a=n.add(Vn({markdef:$r(e),context:{$context:!0},groups:n.lookup(),parent:n.signals.parent?n.signalRef("parent"):null,index:n.markpath(),pulse:he(a)})),f=he(a),a=n.add(jn(Ge(e.encode,e.type,m,n,{pulse:f}))),a.params.parent=n.encode(),e.transform&&e.transform.forEach(function(e){var r=Er(e,n);(r.metadata.generates||r.metadata.changes)&&t.error("Mark transforms should not generate new data."),r.params.pulse=he(a),n.add(a=r)}),e.sort&&(a=n.add(Tn({sort:n.compareRef(e.sort),pulse:he(a)}))),p=he(a),(y||x)&&(x=n.add(Nn({layout:n.objectProperty(e.layout),legendMargin:n.config.legendMargin,mark:f,pulse:p})),g=he(x)),l=n.add(wn({mark:f,pulse:g||p})),h=he(l),v&&(b&&(r=n.operators,r.pop(),x&&r.pop()),n.pushState(p,g||h,c),y?Fr(e,n,i):b?Ar(e,n,i):Yr(e,n),n.popState(),b&&(x&&r.push(x),r.push(l))),s=n.add(Bn({pulse:h})),u=n.add(In({pulse:h},void 0,n.parent())),null!=e.name&&(d=Dr(e.name),n.addData(d,new dt(n,o,s,u)),e.on&&e.on.forEach(function(e){(e.insert||e.remove||e.toggle)&&t.error("Marks only support modify triggers."),Mr(e,n,d)}))},Cr=function(e,n){var r,a,i,o,l,s,u,d,c=e.type||"symbol",f=n.config.legend,p=e.name||void 0,g=e.encode||{},h=!!e.interactive,m=e.size||e.shape||e.fill||e.stroke||e.strokeDash||e.opacity;return m||t.error("Missing valid scale for legend."),r={orient:gt(e.orient,f.orient),title:null!=e.title},a=he(n.add(zn(null,[r]))),s=He({enter:mt(f),update:{offset:Xe(gt(e.offset,f.offset)),padding:Xe(gt(e.padding,f.padding)),titlePadding:Xe(gt(e.titlePadding,f.titlePadding))}},g.legend),u={update:{x:{field:{group:"padding"}},y:{field:{group:"padding"}},entryPadding:Xe(gt(e.entryPadding,f.entryPadding))}},"gradient"===c?(i=he(n.add(_n({type:"gradient",scale:n.scaleRef(m),count:n.property(e.tickCount),values:n.objectProperty(e.values),formatSpecifier:n.property(e.format)}))),d=[vr(m,f,g.gradient),Rr(0,f,g.labels,i)]):(i=he(n.add(_n({size:ht(e,f,g.labels),scale:n.scaleRef(m),count:n.property(e.tickCount),values:n.property(e.values),formatSpecifier:n.property(e.format)}))),d=[zr(e,f,g.symbols,i),wr(0,f,g.labels,i)]),d=[Or("legend-entry",null,a,h,u,d)],r.title&&(l=Pr(e,f,g.title,a),u.update.y.offset={field:{group:"titlePadding"},offset:l.encode.update.fontSize||l.encode.enter.fontSize},d.push(l)),o=Or("legend",p,a,h,s,d),e.zindex&&(o.zindex=e.zindex),Wr(o,n)},Lr=function(e,n){e=t.isString(e)?{text:e}:e;var r,a,i,o=n.config.title,l=t.extend({},e.encode);return r={orient:null!=e.orient?e.orient:o.orient},a=he(n.add(zn(null,[r]))),l.name=e.name,l.interactive=e.interactive,i=vt(e,o,l,a),e.zindex&&(i.zindex=e.zindex),Wr(i,n)},qr=function(e,n){var r=n.config,a=e.orient,i=a===yr||a===br?r.axisX:r.axisY,o=r["axis"+a[0].toUpperCase()+a.slice(1)],l="band"===n.scaleType(e.scale)&&r.axisBand;return i||o||l?t.extend({},r.axis,i,o,l):r.axis},Br=function(e,t,n,r){var a,i,o,l,s,u=e.orient,d={value:0},c={};return c.enter=a={opacity:d},Ye(a,"stroke",t.domainColor),Ye(a,"strokeWidth",t.domainWidth),c.exit={opacity:d},c.update=i={opacity:{value:1}},u===yr||u===br?(o="x",s="y"):(o="y",s="x"),l=o+"2",a[s]=d,i[o]=a[o]=kt(e,0),i[l]=a[l]=kt(e,1),gr("rule","axis-domain",null,r,c,n)},Ur=function(e,t,n,r){var a,i,o,l,s,u,d,c,f=e.orient,p=e.gridScale,g=f===xr||f===yr?1:-1,h=g*e.offset||0,m={value:0},v={};return v.enter=a={opacity:m},Ye(a,"stroke",t.gridColor),Ye(a,"strokeWidth",t.gridWidth),Ye(a,"strokeDash",t.gridDash),v.exit=i={opacity:m},v.update=o={},Ye(o,"opacity",t.gridOpacity),l={scale:e.scale,field:kr,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra},f===yr||f===br?(s="x",u="y",c="height"):(s="y",u="x",c="width"),d=u+"2",o[s]=a[s]=i[s]=l,p?(a[u]={scale:p,range:0,mult:g,offset:h},o[d]=a[d]={scale:p,range:1,mult:g,offset:h}):(a[u]={value:h},o[d]=a[d]={signal:c,mult:g,offset:h}),gr("rule","axis-grid",kr,r,v,n)},Ir=function(e,t,n,r,a){var i,o,l,s,u,d=e.orient,c=d===xr||d===yr?-1:1,f={value:0},p={};return p.enter=i={opacity:f},Ye(i,"stroke",t.tickColor),Ye(i,"strokeWidth",t.tickWidth),p.exit=o={opacity:f},p.update=l={opacity:{value:1}},s=Xe(a),s.mult=c,u={scale:e.scale,field:kr,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra},d===yr||d===br?(l.y=i.y=f,l.y2=i.y2=s,l.x=i.x=o.x=u):(l.x=i.x=f,l.x2=i.x2=s,l.y=i.y=o.y=u),gr("rule","axis-tick",kr,r,p,n)},Tr=function(e,t,n,r,a){var i,o,l,s,u,d=e.orient,c=d===xr||d===yr?-1:1,f=null!=e.labelPadding?e.labelPadding:t.labelPadding,p={value:0},g={};return g.enter=i={opacity:p},Ye(i,"angle",t.labelAngle),Ye(i,"fill",t.labelColor),Ye(i,"font",t.labelFont),Ye(i,"fontSize",t.labelFontSize),Ye(i,"limit",t.labelLimit),g.exit=o={opacity:p},g.update=l={opacity:{value:1},text:{field:"label"}},s=Xe(a),s.mult=c,s.offset=Xe(f),s.offset.mult=c,u={scale:e.scale,field:kr,band:.5},d===yr||d===br?(l.y=i.y=s,l.x=i.x=o.x=u,Ye(l,"align","center"),Ye(l,"baseline",d===yr?"bottom":"top")):(l.x=i.x=s,l.y=i.y=o.y=u,Ye(l,"align","right"===d?"left":"right"),Ye(l,"baseline","middle")),gr(mr,"axis-label",kr,r,g,n)},Nr=function(e,t,n,r){var a,i,o,l=e.orient,s=e.title,u=l===xr||l===yr?-1:1,d=l===yr||l===br,c={};return c.enter=a={opacity:{value:0}},Ye(a,"align",t.titleAlign),Ye(a,"fill",t.titleColor),Ye(a,"font",t.titleFont),Ye(a,"fontSize",t.titleFontSize),Ye(a,"fontWeight",t.titleFontWeight),Ye(a,"limit",t.titleLimit),c.exit={opacity:{value:0}},c.update=i={opacity:{value:1},text:s&&s.signal?{signal:s.signal}:{value:s+""}},o={scale:e.scale,range:.5},d?(i.x=o,i.angle={value:0},i.baseline={value:l===yr?"bottom":"top"}):(i.y=o,i.angle={value:90*u},i.baseline={value:"bottom"}),Ye(i,"angle",t.titleAngle),Ye(i,"baseline",t.titleBaseline),!Ye(i,"x",t.titleX)&&d&&!Ke(n,"x")&&(c.enter.auto={value:!0}),!Ye(i,"y",t.titleY)&&!d&&!Ke(n,"y")&&(c.enter.auto={value:!0}),gr(mr,"axis-title",null,r,c,n)},Xr=function(e,t){var n,r,a,i,o,l,s,u=qr(e,t),d=e.name||void 0,c=e.encode||{},f=!!e.interactive;return n={orient:e.orient,ticks:null!=e.ticks?!!e.ticks:u.ticks,labels:null!=e.labels?!!e.labels:u.labels,grid:null!=e.grid?!!e.grid:u.grid,domain:null!=e.domain?!!e.domain:u.domain,title:null!=e.title},r=he(t.add(zn({},[n]))),l=He({update:{range:{signal:'abs(span(range("'+e.scale+'")))'},offset:Xe(e.offset||0),position:Xe(e.position||0),titlePadding:Xe(e.titlePadding||u.titlePadding),minExtent:Xe(e.minExtent||u.minExtent),maxExtent:Xe(e.maxExtent||u.maxExtent)}},c.axis),a=he(t.add(Rn({scale:t.scaleRef(e.scale),extra:u.tickExtra,count:t.property(e.tickCount),values:t.objectProperty(e.values),formatSpecifier:t.property(e.format)}))),s=[],n.grid&&s.push(Ur(e,u,c.grid,a)),n.ticks&&(i=null!=e.tickSize?e.tickSize:u.tickSize,s.push(Ir(e,u,c.ticks,a,i))),n.labels&&(i=n.ticks?i:0,s.push(Tr(e,u,c.labels,a,i))),n.domain&&s.push(Br(e,u,c.domain,r)),n.title&&s.push(Nr(e,u,c.title,r)),o=Or("axis",d,r,f,l,s),e.zindex&&(o.zindex=e.zindex),Wr(o,t)},Yr=function(e,n,r){var a=t.array(e.signals),i=t.array(e.scales);return r||a.forEach(function(e){_t(e,n)}),t.array(e.projections).forEach(function(e){Kn(e,n)}),i.forEach(function(e){ze(e,n)}),t.array(e.data).forEach(function(e){yt(e,n)}),i.forEach(function(e){Pe(e,n)}),a.forEach(function(e){xn(e,n)}),t.array(e.axes).forEach(function(e){Xr(e,n)}),t.array(e.marks).forEach(function(e){Wr(e,n)}),t.array(e.legends).forEach(function(e){Cr(e,n)}),e.title&&Lr(e.title,n),n.parseLambdas(),n},Hr=t.toSet(["width","height","padding"]),Gr=Rt.prototype=wt.prototype;Gr.fork=function(){return new wt(this)},Gr.toRuntime=function(){return this.finish(),{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings}},Gr.id=function(){return(this._subid?this._subid+":":0)+this._id++},Gr.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(function(t){t.$ref=e.id}),e.refs=null),e},Gr.proxy=function(e){var t=e instanceof fe?he(e):e;return this.add(Ln({value:t}))},Gr.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},Gr.addUpdate=function(e){return this.updates.push(e),e},Gr.finish=function(){function e(e,t,n){var r,a;e&&(r=e.data||(e.data={}),a=r[t]||(r[t]=[]),a.push(n))}var t,n;this.root&&(this.root.root=!0);for(t in this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;for(t in this.data){n=this.data[t],e(n.input,t,"input"),e(n.output,t,"output"),e(n.values,t,"values");for(var r in n.index)e(n.index[r],t,"index:"+r)}return this},Gr.pushState=function(e,t,n){this._encode.push(he(this.add(In({pulse:e})))),this._parent.push(t),this._lookup.push(n?he(this.proxy(n)):null),this._markpath.push(-1)},Gr.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},Gr.parent=function(){return t.peek(this._parent)},Gr.encode=function(){return t.peek(this._encode)},Gr.lookup=function(){return t.peek(this._lookup)},Gr.markpath=function(){var e=this._markpath;return++e[e.length-1]},Gr.fieldRef=function(e,n){if(t.isString(e))return me(e,n);e.signal||t.error("Unsupported field reference: "+t.stringValue(e));var r,a=e.signal,i=this.field[a];return i||(r={name:this.signalRef(a)},n&&(r.as=n),this.field[a]=i=he(this.add(Dn(r)))),i},Gr.compareRef=function(e){function n(e){return ke(e)?(a=!0,he(r[e.signal])):e}var r=this.signals,a=!1,i=t.array(e.field).map(n),o=t.array(e.order).map(n);return a?he(this.add(Pn({fields:i,orders:o}))):ve(i,o)},Gr.keyRef=function(e){function n(e){return ke(e)?(a=!0,he(r[e.signal])):e}var r=this.signals,a=!1;return e=t.array(e).map(n),a?he(this.add(En({fields:e}))):ye(e)},Gr.sortRef=function(e){if(!e)return e;var t=[be(e.op,e.field),"_id"],n=e.order||"ascending";return n.signal?he(this.add(Pn({fields:t,orders:[n=this.signalRef(n.signal),n]}))):ve(t,[n,n])},Gr.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},Gr.addSignal=function(e,n){this.signals.hasOwnProperty(e)&&t.error("Duplicate signal name: "+t.stringValue(e));var r=n instanceof fe?n:this.add(ge(n));return this.signals[e]=r},Gr.getSignal=function(e){return this.signals[e]||t.error("Unrecognized signal name: "+t.stringValue(e)),this.signals[e]},Gr.signalRef=function(e){return this.signals[e]?he(this.signals[e]):(this.lambdas[e]||(this.lambdas[e]=this.add(ge(null))),he(this.lambdas[e]))},Gr.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var r=e[t],a=pn(r,this),i=this.lambdas[r];i.params=a.$params,i.update=a.$expr}},Gr.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},Gr.objectProperty=function(e){return e&&t.isObject(e)?this.signalRef(e.signal||zt(e)):e},Gr.addBinding=function(e,n){this.bindings||t.error("Nested signals do not support binding: "+t.stringValue(e)),this.bindings.push(t.extend({signal:e},n))},Gr.addScaleProj=function(e,n){this.scales.hasOwnProperty(e)&&t.error("Duplicate scale or projection name: "+t.stringValue(e)),this.scales[e]=this.add(n)},Gr.addScale=function(e,t){this.addScaleProj(e,Un(t))},Gr.addProjection=function(e,t){this.addScaleProj(e,Cn(t))},Gr.getScale=function(e){return this.scales[e]||t.error("Unrecognized scale name: "+t.stringValue(e)),this.scales[e]},Gr.projectionRef=Gr.scaleRef=function(e){return he(this.getScale(e))},Gr.projectionType=Gr.scaleType=function(e){return this.getScale(e).params.type},Gr.addData=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.data[e]=n},Gr.getData=function(e){return this.data[e]||t.error("Undefined data set name: "+t.stringValue(e)),this.data[e]},Gr.addDataPipeline=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.addData(e,dt.fromEntries(this,n))};var Jr=function(e){var n,r=jt();for(n in e)r[n]=t.isObject(r[n])?t.extend(r[n],e[n]):r[n]=e[n];return r},Kr=30,Qr=2,Zr="#4c78a8",ea="#000",ta="#888",na="#ddd",ra=function(e,n){return t.isObject(e)||t.error("Input Vega specification must be an object."),St(e,new Rt(Jr(n||e.config))).toRuntime()};e.parse=ra,e.signal=_t,e.signalUpdates=xn,e.stream=mn,e.codeGenerator=fn,e.functionContext=on,e.expressionFunction=re,e.MarkRole=dr,e.FrameRole=cr,e.ScopeRole="scope",e.AxisRole="axis",e.AxisDomainRole="axis-domain",e.AxisGridRole="axis-grid",e.AxisLabelRole="axis-label",e.AxisTickRole="axis-tick",e.AxisTitleRole="axis-title",e.LegendRole="legend",e.LegendEntryRole="legend-entry",e.LegendLabelRole="legend-label",e.LegendSymbolRole="legend-symbol",e.LegendTitleRole="legend-title",e.Scope=Rt,e.DataScope=dt,e.formatLocale=i.formatDefaultLocale,e.timeFormatLocale=o.timeFormatDefaultLocale,Object.defineProperty(e,"__esModule",{value:!0})});